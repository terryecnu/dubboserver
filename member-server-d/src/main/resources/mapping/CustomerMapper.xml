<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bestpay.member.mapper.CustomerMapper" >
  <resultMap id="BaseResultMap" type="com.bestpay.member.po.Customer" >
    <id column="id" property="crmId" jdbcType="INTEGER" />
    <result column="user_no" property="userNo" jdbcType="VARCHAR" />
    <result column="id_number" property="idNumber" jdbcType="VARCHAR" />
    <result column="real_name" property="realName" jdbcType="VARCHAR" />
    <result column="gender" property="gender" jdbcType="INTEGER" />
    <result column="nick_name" property="nickName" jdbcType="VARCHAR" />
    <result column="head_img" property="headImg" jdbcType="VARCHAR" />
    <result column="birthday" property="birthday" jdbcType="TIMESTAMP" />
    <result column="register_time" property="registerTime" jdbcType="TIMESTAMP" />
    <result column="phone_number" property="phoneNumber" jdbcType="VARCHAR" />
    <result column="growth_value" property="growthValue" jdbcType="DOUBLE" />
    <result column="heath_file" property="heathFile" jdbcType="INTEGER" />
    <result column="id_rank" property="idRank" jdbcType="INTEGER" />
    <result column="last_device_type" property="lastDeviceType" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="created_at" property="createdAt" jdbcType="TIMESTAMP" />
    <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP" />
    <result column="created_by" property="createdBy" jdbcType="VARCHAR" />
    <result column="updated_by" property="updatedBy" jdbcType="VARCHAR" />
    <result column="growth_rate" property="growthRate" jdbcType="DOUBLE" />
    <result column="is_birthday_rate" property="isBirthdayRate" jdbcType="INTEGER" />
    <result column="acct_amount" property="acctAmount" jdbcType="DOUBLE" />
    <result column="insurance_number" property="insuranceNumber" jdbcType="INTEGER" />
  </resultMap>


  <resultMap id="CustomerGrowthValue" type="com.bestpay.member.dto.CustomerDto">
    <result column="user_no" property="userNo" jdbcType="VARCHAR" />
    <result column="nick_name" property="nickName" jdbcType="VARCHAR" />
    <result column="head_img" property="headImg" jdbcType="VARCHAR" />
    <result column="growth_value" property="growthValue" jdbcType="DOUBLE" />
    <result column="id_rank" property="idRank" jdbcType="INTEGER" />
    <result column="rank_name" property="rankName" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, user_no, id_number, real_name, gender, nick_name, head_img, birthday, register_time, 
    phone_number, growth_value, heath_file, id_rank, last_device_type, status,
    created_at, updated_at, created_by, updated_by, growth_rate, is_birthday_rate, acct_amount,
    insurance_number
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select
    <include refid="Base_Column_List" />
    from t_insurance_crm_customer
    where id = #{crmId,jdbcType=INTEGER}
  </select>
  <select id="selectById" parameterType="java.lang.Integer" resultType="com.bestpay.member.po.Customer">
        select * from t_insurance_crm_customer t where t.id=#{custId}
  </select>
  <select id="queryCount" resultType="java.lang.Integer">
        select count(1)  from t_insurance_crm_customer
  </select>

  <select id="selectCustomerDtoByUserNo" resultMap="CustomerGrowthValue" parameterType="java.lang.String">
      select
      tc.user_no,tc.nick_name, tc.head_img,tc.growth_value,tc.id_rank,tr.rank_name
      from t_insurance_crm_customer tc,t_insurance_crm_member_rank tr
      WHERE tc.id_rank = tr.id
      AND tc.user_no = #{userNo}
  </select>
  <!--查询用户是否存在-->
  <select id="isUserExists" resultType="java.lang.Integer" parameterType="java.lang.String">
    select count(1) from t_insurance_crm_customer t where t.user_no = #{userNo}
  </select>

  <select id="selectByUserNo" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select
    <include refid="Base_Column_List" />
    from t_insurance_crm_customer
    where user_no = #{userNo,jdbcType=INTEGER}
  </select>
  <!--查询会员中心权益项 -->
  <select id="queryRightsByUserNo" resultType="com.bestpay.member.dto.RightDto" parameterType="java.lang.String">
    select tr.id as insuranceCrmRightId,
    tr.right_options AS  rightOptions,
    trt.t_insurance_crm_right_options_name AS rightOptionsName,
    trt.light_img as rightIconImg,
    trt.dark_img as rightIconDarkImg
    FROM t_insurance_crm_customer tc,t_insurance_crm_member_rank_content trc,
    t_insurance_crm_right tr,t_insurance_crm_right_option_type trt
    where tc.id_rank = trc.member_rank_id
    AND tr.right_options = trt.id
    AND trc.busi_code = 1
    AND trc.busi_id = tr.id
    AND tc.user_no = #{userNo}
    AND tr.is_valid = 1
    AND trc.is_valid = 1
    AND tr.right_status = 5
    order BY tr.sort_order DESC ,tr.created_at desc,tr.id DESC
  </select>
  <!--查询基本权益暗图标 -->
  <select id="queryAllBasicRights" resultType="com.bestpay.member.dto.RightDto" >
    select trt.id as rightOptions,
    trt.t_insurance_crm_right_options_name AS rightOptionsName,
    trt.dark_img as rightIconImg
    from t_insurance_crm_right_option_type trt
  </select>
  <!--查询用户中心产品推荐列表-->
  <select id="selectMemberCenterProductsByUserNo" resultType="com.bestpay.member.dto.ProductDto" parameterType="java.lang.String">
    select
    ts.id as  productRecommentId,
    ts.member_product_recommendation_class as productRecommendationClass,
    ts.product_id as productId,
    ts.product_name as productName,
    ts.product_price as productPrice,
    ts.product_discount_price as productDiscountPrice,
    ts.product_sign as productSign,
    ts.product_url as  productUrl,
    ts.product_img as productImg
    from t_insurance_crm_customer tc,t_insurance_crm_member_rank_content trc,
    t_insurance_crm_service ts
    where tc.id_rank = trc.member_rank_id
    and trc.busi_code = 2
    AND trc.busi_id = ts.id
    AND ts.is_invalid = 1
    and trc.is_valid = 1
    AND ts.status = 5
    AND tc.user_no = #{userNo}
    order BY ts.sort desc,ts.created_at desc,ts.id desc
  </select>


  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from t_insurance_crm_customer
    where id = #{crmId,jdbcType=INTEGER}
  </delete>

  <insert id="insertSelective" parameterType="com.bestpay.member.po.Customer" >
    insert into t_insurance_crm_customer
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="crmId != null" >
        id,
      </if>
      <if test="userNo != null" >
        user_no,
      </if>
      <if test="idNumber != null" >
        id_number,
      </if>
      <if test="realName != null" >
        real_name,
      </if>
      <if test="gender != null" >
        gender,
      </if>
      <if test="nickName != null" >
        nick_name,
      </if>
      <if test="headImg != null" >
        head_img,
      </if>
      <if test="birthday != null" >
        birthday,
      </if>
      <if test="registerTime != null" >
        register_time,
      </if>
      <if test="phoneNumber != null" >
        phone_number,
      </if>
      <if test="growthValue != null" >
        growth_value,
      </if>
      <if test="heathFile != null" >
        heath_file,
      </if>
      <if test="idRank != null" >
        id_rank,
      </if>
      <if test="lastDeviceType != null" >
        last_device_type,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="createdAt != null" >
        created_at,
      </if>
      <if test="updatedAt != null" >
        updated_at,
      </if>
      <if test="createdBy != null" >
        created_by,
      </if>
      <if test="updatedBy != null" >
        updated_by,
      </if>
      <if test="growthRate != null" >
        growth_rate,
      </if>
      <if test="isBirthdayRate != null" >
        is_birthday_rate,
      </if>
      <if test="acctAmount != null" >
        acct_amount,
      </if>
      <if test="insuranceNumber != null" >
        insurance_number,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="crmId != null" >
        #{crmId,jdbcType=INTEGER},
      </if>
      <if test="userNo != null" >
        #{userNo,jdbcType=VARCHAR},
      </if>
      <if test="idNumber != null" >
        #{idNumber,jdbcType=VARCHAR},
      </if>
      <if test="realName != null" >
        #{realName,jdbcType=VARCHAR},
      </if>
      <if test="gender != null" >
        #{gender,jdbcType=INTEGER},
      </if>
      <if test="nickName != null" >
        #{nickName,jdbcType=VARCHAR},
      </if>
      <if test="headImg != null" >
        #{headImg,jdbcType=VARCHAR},
      </if>
      <if test="birthday != null" >
        #{birthday,jdbcType=TIMESTAMP},
      </if>
      <if test="registerTime != null" >
        #{registerTime,jdbcType=TIMESTAMP},
      </if>
      <if test="phoneNumber != null" >
        #{phoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="growthValue != null" >
        #{growthValue,jdbcType=DOUBLE},
      </if>
      <if test="heathFile != null" >
        #{heathFile,jdbcType=INTEGER},
      </if>
      <if test="idRank != null" >
        #{idRank,jdbcType=INTEGER},
      </if>
      <if test="lastDeviceType != null" >
        #{lastDeviceType,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="createdAt != null" >
        #{createdAt,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedAt != null" >
        #{updatedAt,jdbcType=TIMESTAMP},
      </if>
      <if test="createdBy != null" >
        #{createdBy,jdbcType=VARCHAR},
      </if>
      <if test="updatedBy != null" >
        #{updatedBy,jdbcType=VARCHAR},
      </if>
      <if test="growthRate != null" >
        #{growthRate,jdbcType=DOUBLE},
      </if>
      <if test="isBirthdayRate != null" >
        #{isBirthdayRate,jdbcType=INTEGER},
      </if>
      <if test="acctAmount != null" >
        #{acctAmount,jdbcType=DOUBLE},
      </if>
      <if test="insuranceNumber != null" >
        #{insuranceNumber,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.bestpay.member.po.Customer" >
    update t_insurance_crm_customer
    <set >
      <if test="userNo != null" >
        user_no = #{userNo,jdbcType=VARCHAR},
      </if>
      <if test="idNumber != null" >
        id_number = #{idNumber,jdbcType=VARCHAR},
      </if>
      <if test="realName != null" >
        real_name = #{realName,jdbcType=VARCHAR},
      </if>
      <if test="gender != null" >
        gender = #{gender,jdbcType=INTEGER},
      </if>
      <if test="nickName != null" >
        nick_name = #{nickName,jdbcType=VARCHAR},
      </if>
      <if test="headImg != null" >
        head_img = #{headImg,jdbcType=VARCHAR},
      </if>
      <if test="birthday != null" >
        birthday = #{birthday,jdbcType=TIMESTAMP},
      </if>
      <if test="registerTime != null" >
        register_time = #{registerTime,jdbcType=TIMESTAMP},
      </if>
      <if test="phoneNumber != null" >
        phone_number = #{phoneNumber,jdbcType=VARCHAR},
      </if>
      <if test="growthValue != null" >
        growth_value = #{growthValue,jdbcType=DOUBLE},
      </if>
      <if test="heathFile != null" >
        heath_file = #{heathFile,jdbcType=INTEGER},
      </if>
      <if test="idRank != null" >
        id_rank = #{idRank,jdbcType=INTEGER},
      </if>
      <if test="lastDeviceType != null" >
        last_device_type = #{lastDeviceType,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="createdAt != null" >
        created_at = #{createdAt,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedAt != null" >
        updated_at = #{updatedAt,jdbcType=TIMESTAMP},
      </if>
      <if test="createdBy != null" >
        created_by = #{createdBy,jdbcType=VARCHAR},
      </if>
      <if test="updatedBy != null" >
        updated_by = #{updatedBy,jdbcType=VARCHAR},
      </if>
      <if test="growthRate != null" >
        growth_rate = #{growthRate,jdbcType=DOUBLE},
      </if>
      <if test="isBirthdayRate != null" >
        is_birthday_rate = #{isBirthdayRate,jdbcType=INTEGER},
      </if>
      <if test="acctAmount != null" >
        acct_amount = #{acctAmount,jdbcType=DOUBLE},
      </if>
      <if test="insuranceNumber != null" >
        insurance_number = #{insuranceNumber,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{crmId,jdbcType=INTEGER}
  </update>

</mapper>